<div class="calculator-widget">
  @if (config.description) {
    <p class="calculator-description">{{ config.description }}</p>
  }

  <div class="calculator-content">
    <!-- Inputs Section -->
    <div class="calculator-inputs">
      <div class="formula-display">
        <strong>Formula:</strong> <code>{{ config.formula }}</code>
      </div>

      @for (input of config.inputs; track input.name) {
        <div class="input-group">
          <label [for]="'calc-input-' + input.name">
            {{ input.label }}:
            <span class="input-value">{{ inputValues()[input.name] }}</span>
          </label>
          <input
            [id]="'calc-input-' + input.name"
            type="range"
            [min]="input.min ?? 0"
            [max]="input.max ?? 100"
            [step]="input.step ?? 1"
            [value]="inputValues()[input.name]"
            (input)="updateValue(input.name, +$any($event.target).value)"
            class="slider"
          />
          <input
            type="number"
            [min]="input.min ?? 0"
            [max]="input.max ?? 100"
            [step]="input.step ?? 1"
            [value]="inputValues()[input.name]"
            (input)="updateValue(input.name, +$any($event.target).value)"
            class="number-input"
          />
        </div>
      }

      <!-- Result Display -->
      <div class="result-display">
        <strong>Result:</strong>
        <span class="result-value">{{ result() }}</span>
      </div>
    </div>

    <!-- Graph Section -->
    @if (config.graph && graphData()) {
      <div class="calculator-graph">
        <h4>Visualization</h4>
        <div class="graph-container">
          <svg viewBox="0 -20 575 395" preserveAspectRatio="xMidYMid meet" class="graph-svg">
          <!-- Axes -->
          <line x1="70" y1="5" x2="70" y2="335" class="axis-line" stroke="#999" stroke-width="2" />
          <line x1="70" y1="335" x2="540" y2="335" class="axis-line" stroke="#999" stroke-width="2" />
          
          <!-- Grid lines -->
          <g class="grid">
            <!-- Y-axis grid lines -->
            @for (yLine of getYGridLines(); track yLine) {
              <line
                [attr.x1]="70"
                [attr.y1]="toSvgY(yLine, 330) + 5"
                [attr.x2]="540"
                [attr.y2]="toSvgY(yLine, 330) + 5"
                class="grid-line"
              />
              <text
                [attr.x]="65"
                [attr.y]="toSvgY(yLine, 330) + 10"
                class="grid-label"
                text-anchor="end"
              >
                {{ yLine.toFixed(1) }}
              </text>
            }
            
            <!-- X-axis grid lines -->
            @for (xLine of getXGridLines(); track xLine) {
              <line
                [attr.x1]="toSvgX(xLine, 470) + 70"
                [attr.y1]="5"
                [attr.x2]="toSvgX(xLine, 470) + 70"
                [attr.y2]="335"
                class="grid-line"
              />
              <text
                [attr.x]="toSvgX(xLine, 470) + 70"
                [attr.y]="355"
                class="grid-label x-label"
                text-anchor="middle"
              >
                {{ xLine.toFixed(0) }}
              </text>
            }
          </g>

          <!-- Graph line -->
          <g transform="translate(70, 5)">
            <path
              [attr.d]="getGraphPath()"
              class="graph-line"
              fill="none"
              stroke="var(--accent-color, #4a9eff)"
              stroke-width="3"
            />

            <!-- Current point indicator -->
            @if (getXAxisInput() && typeof result() === 'number') {
              <circle
                [attr.cx]="toSvgX(inputValues()[getXAxisInput()!.name], 470)"
                [attr.cy]="toSvgY(getNumericResult(), 330)"
                r="6"
                fill="var(--accent-color, #4a9eff)"
                class="current-point"
              />
            }
          </g>
        </svg>

          @if (getXAxisInput()) {
            <div class="y-axis-label">↑ Result</div>
          }
        </div>

        @if (getXAxisInput()) {
          <div class="graph-axis-labels">
            <div class="x-axis-label">{{ getXAxisInput()!.label }} →</div>
          </div>
        }
      </div>
    }
  </div>
</div>

